<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | La Ruta Garage</title>
    <link rel="icon" type="image/png" href="https://firebasestorage.googleapis.com/v0/b/d-clan-athletes.firebasestorage.app/o/La%20Ruta%20Garage%2FFavicon.png?alt=media&token=0e2d4383-2c9b-4005-9b46-943b40c0637d">
    <meta name="description" content="Vuelve la competencia que pone a prueba tus límites en Maturín. ¡Un Plan, Una Ruta, Una Meta!">
    <meta property="og:title" content="La Ruta Garage | Official Event 2026">
    <meta property="og:description" content="La competencia que pone a prueba tus límites en Maturín. ¡Un Plan, Una Ruta, Una Meta!">
    <meta property="og:image" content="https://firebasestorage.googleapis.com/v0/b/d-clan-athletes.firebasestorage.app/o/La%20Ruta%20Garage%2FImageMetadatos.jpg?alt=media&token=293c8a99-ed99-4155-8bfa-ecbbcc72b846">
    <meta property="og:url" content="https://www.larutagarage.com/inscripcion"> 
    <meta property="og:type" content="website">
    
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;600;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root { 
            --neon: #d8ff5e; 
            --bg: #050505; 
            --glass: rgba(20, 20, 20, 0.7);
        }

        body { 
            background: linear-gradient(rgba(0,0,0,0.8), rgba(0,0,0,0.8)), 
                        url('https://firebasestorage.googleapis.com/v0/b/d-clan-athletes.firebasestorage.app/o/La%20Ruta%20Garage%2FbglarutawebsiteBlack.jpg?alt=media&token=8e8d0ddb-b8a4-43f0-8199-98d31beaf078'); 
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            color: white; 
            font-family: 'Montserrat', sans-serif; 
            padding: 10px; 
            margin: 0; 
            display: none; 
            min-height: 100vh;
        }
        
        #modalEditar { 
            display:none; 
            position:fixed; 
            top:0; left:0; 
            width:100%; height:100%; 
            background:rgba(0,0,0,0.9); 
            z-index:2000; 
            overflow-y:auto; 
            padding:20px; 
            box-sizing: border-box; 
        }
        .modal-content { 
            max-width:600px; 
            margin:auto; 
            background: var(--glass);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(216, 255, 94, 0.2);
            padding:30px; 
            border-radius:20px; 
        }
        .edit-grid { display:grid; grid-template-columns: 1fr 1fr; gap:15px; margin-top: 20px; }
        .edit-grid div { display: flex; flex-direction: column; }
        .edit-grid label { font-size: 0.65rem; color: var(--neon); text-transform: uppercase; margin-bottom: 5px; font-weight: 600; }
        .edit-grid input { background: rgba(0,0,0,0.5); border: 1px solid #333; color: white; padding: 12px; border-radius: 8px; font-size: 0.85rem; font-family: 'Montserrat'; }

        .header-admin { text-align: center; margin-bottom: 20px; padding-top: 20px; }
        .header-admin img { width: 120px; margin-bottom: 10px; filter: drop-shadow(0 0 10px rgba(216, 255, 94, 0.2)); }
        h1 { font-weight: 900; color: var(--neon); text-align: center; font-size: 1.4rem; margin: 0; letter-spacing: 2px; text-transform: uppercase; }

        .controls { max-width: 1200px; margin: 20px auto; display: flex; flex-wrap: wrap; gap: 10px; padding: 0 10px; }
        .search-box { flex: 1; min-width: 250px; }
        .search-box input { width: 100%; padding: 15px; background: var(--glass); backdrop-filter: blur(10px); border: 1px solid #333; color: white; border-radius: 12px; box-sizing: border-box; font-family: 'Montserrat'; }
        
        .filter-buttons { display: flex; gap: 8px; width: 100%; margin-bottom: 10px; }
        .btn-filter { flex: 1; padding: 14px; background: rgba(0,0,0,0.6); color: white; border: 1px solid #333; border-radius: 10px; cursor: pointer; font-weight: 600; font-size: 0.7rem; text-transform: uppercase; font-family: 'Montserrat'; transition: 0.3s; }
        .btn-filter.active { background: var(--neon); color: black; border-color: var(--neon); font-weight: 900; }

        .container { max-width: 1200px; margin: auto; background: var(--glass); backdrop-filter: blur(10px); border-radius: 15px; border: 1px solid rgba(255,255,255,0.05); overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.5); margin-bottom: 15px; }
        .table-wrapper { overflow-x: auto; }
        table { width: 100%; border-collapse: collapse; }
        th { background: rgba(216, 255, 94, 0.05); color: var(--neon); text-align: left; padding: 12px 15px; font-size: 0.7rem; font-weight: 900; text-transform: uppercase; border-bottom: 2px solid var(--neon); }
        
        td { padding: 8px 15px; border-bottom: 1px solid rgba(255,255,255,0.05); font-size: 0.8rem; font-weight: 300; }

        .pagination { display: flex; justify-content: center; align-items: center; gap: 15px; padding: 25px; }
        .btn-pag { background: #111; color: white; border: 1px solid #333; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-family: 'Montserrat'; font-weight: 600; font-size: 0.7rem; }
        
        .btn { padding: 8px 12px; border: none; border-radius: 6px; cursor: pointer; font-weight: 600; font-size: 0.65rem; display: inline-flex; align-items: center; gap: 8px; transition: 0.3s; }
        .btn-view { background: rgba(255,255,255,0.05); color: #ccc; border-color: #333; }
        .btn-approve { background: var(--neon); color: black; font-weight: 900; }
        .btn-delete { background: transparent; color: #ff4444; border: 1px solid rgba(255,68,68,0.3); }
        .btn-wa { background: transparent; color: #25D366; border: 1px solid #25D366; }

        .badge { padding: 4px 8px; border-radius: 6px; font-size: 0.65rem; font-weight: 900; }
        .status-pendiente { border: 1px solid #ffaa00; color: #ffaa00; }
        .status-aprobado { border: 1px solid var(--neon); color: var(--neon); background: rgba(216, 255, 94, 0.1); }

        .heat-header { background: var(--neon); color: black; padding: 8px 15px; font-weight: 900; text-transform: uppercase; font-size: 0.8rem; display: flex; justify-content: space-between; align-items: center; }
        .atleta-chip { cursor: pointer; padding: 6px 12px; border: 1px solid #333; border-radius: 30px; font-size: 0.7rem; transition: 0.3s; background: rgba(255,255,255,0.05); }
        .atleta-chip.selected { border-color: var(--neon); color: var(--neon); background: rgba(216, 255, 94, 0.1); }

        /* NUEVA VERSIÓN MÓVIL ULTRA COMPACTA */
        @media (max-width: 800px) {
            .header-admin img { width: 80px; }
            h1 { font-size: 1.1rem; }
            .btn-filter { padding: 10px; font-size: 0.6rem; }
            
            /* Forzar que se mantenga como tabla y no como bloques */
            table thead { display: table-header-group; } /* Volver a mostrar cabeceras */
            table th { padding: 8px 5px; font-size: 0.55rem; }
            table td { 
                display: table-cell; /* Volver a comportamiento de celda */
                padding: 5px; 
                font-size: 0.7rem; 
                border-bottom: 1px solid rgba(255,255,255,0.1);
                vertical-align: middle;
            }
            table tr { display: table-row; background: none; margin-bottom: 0; border: none; }
            
            /* Ocultar etiquetas repetitivas del móvil anterior */
            table td::before { display: none; }
            
            /* Ajustar botones para que quepan en línea */
            .btn { padding: 5px; font-size: 0.6rem; min-width: auto; }
            .btn i { margin: 0; }
            .badge { font-size: 0.55rem; padding: 2px 4px; }
            
            /* Específico para multimedia y acciones para que no se rompan */
            td[data-label="Multimedia"], td[data-label="Acción"], td[data-label="WhatsApp"] {
                white-space: nowrap;
                text-align: center;
            }
        }
    </style>
</head>
<body>

    <div id="modalEditar">
        <div class="modal-content">
            <h2 style="font-weight:900; color:var(--neon); font-size:1.1rem; margin:0; text-transform: uppercase; text-align: center;">Editar Atleta</h2>
            <div id="camposEditar" class="edit-grid"></div>
            <div style="margin-top:30px; display:flex; gap:12px;">
                <button id="btnGuardarEdit" class="btn btn-approve" style="flex:1;">GUARDAR CAMBIOS</button>
                <button onclick="document.getElementById('modalEditar').style.display='none'" class="btn btn-view" style="flex:1;">CANCELAR</button>
            </div>
        </div>
    </div>

    <div class="header-admin">
        <img src="https://firebasestorage.googleapis.com/v0/b/d-clan-athletes.firebasestorage.app/o/La%20Ruta%20Garage%2FLogo%20Icono%20Verde.png?alt=media&token=07ce2638-9667-4bad-8de1-c38abc5112f8" alt="Logo">
        <h1>Dashboard Administrativo</h1>
    </div>

    <div class="controls">
        <div class="filter-buttons">
            <button class="btn-filter active" id="tabGeneral" onclick="switchMainTab('general')">Atletas</button>
            <button class="btn-filter" id="tabLogistica" onclick="switchMainTab('logistica')">Heats / Logística</button>
        </div>
    </div>

    <div id="viewGeneral">
        <div class="controls">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Busca..." oninput="resetearYPaginacion()">
            </div>
            <div class="filter-buttons">
                <button class="btn-filter active" id="btnAll" onclick="filtrarModalidad('todos')">Todos</button>
                <button class="btn-filter" id="btnRace" onclick="filtrarModalidad('race')">Race</button>
                <button class="btn-filter" id="btnCF" onclick="filtrarModalidad('crossfit')">CF</button>
            </div>
        </div>
        <div class="container">
            <div class="table-wrapper">
                <table>
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Atleta</th>
                            <th>Mod.</th>
                            <th>Pago</th>
                            <th>Docs</th>
                            <th>WA</th>
                            <th>Acc.</th>
                        </tr>
                    </thead>
                    <tbody id="tablaAtletas"></tbody>
                </table>
            </div>
            <div class="pagination">
                <button class="btn-pag" id="prevPage" onclick="cambiarPagina(-1)" disabled><i class="fas fa-chevron-left"></i></button>
                <span id="pageInfo" style="font-weight: 600; font-size: 0.7rem;">Pág 1</span>
                <button class="btn-pag" id="nextPage" onclick="cambiarPagina(1)" disabled><i class="fas fa-chevron-right"></i></button>
            </div>
        </div>
    </div>

    <div id="viewLogistica" style="display:none;">
        <div class="controls">
            <div class="filter-buttons">
                <button class="btn-filter active" id="btnHeatRace" onclick="switchHeatType('race')">Race (Auto)</button>
                <button class="btn-filter" id="btnHeatCF" onclick="switchHeatType('cf')">CF (Manual)</button>
            </div>
        </div>
        <div id="containerHeatsRace"></div>
        <div id="containerHeatsCF" style="display:none;">
            <div class="container" style="padding: 15px;">
                <p style="font-size:0.7rem; color:var(--neon); font-weight:600; margin-bottom:10px; text-transform:uppercase;">Selecciona Atletas CF:</p>
                <div id="selectorAtletasCF" style="display:flex; flex-wrap:wrap; gap:8px; margin-bottom:15px;"></div>
                <button class="btn btn-approve" onclick="crearHeatManual()">Crear Heat</button>
            </div>
            <div id="listaHeatsManuales"></div>
        </div>
    </div>

<script>
    const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbyKOZQgueIrJ63Mfxp6Pz87dbVFgQmDgOjKcU990nOMqjuDphoM4UOvrKKkpbWQTwYp/exec";
    const SECRET_KEY = "RutaGarage2026";

    let todosLosAtletas = [];
    let atletasFiltrados = [];
    let paginaActual = 1;
    const registrosPorPagina = 20;
    let modalidadActual = 'todos';
    let atletaAEditar = null;
    let seleccionadosCF = [];
    let heatsCrossfitCreados = [];

    (function validarAcceso() {
        const urlParams = new URLSearchParams(window.location.search);
        if (urlParams.get('key') === SECRET_KEY) {
            document.body.style.display = 'block';
            cargarAtletas();
        } else {
            window.location.href = "https://www.google.com";
        }
    })();

    function formatImgUrl(url) {
        if (!url || url === "") return "https://via.placeholder.com/150?text=No+Foto";
        let id = "";
        if (url.includes("id=")) {
            id = url.split("id=")[1].split("&")[0];
        } else if (url.includes("file/d/")) {
            id = url.split("file/d/")[1].split("/")[0];
        }
        if (id !== "") {
            return "https://lh3.googleusercontent.com/d/" + id;
        }
        return url;
    }

    async function cargarAtletas() {
        try {
            const response = await fetch(WEB_APP_URL + "?t=" + new Date().getTime());
            todosLosAtletas = await response.json();
            todosLosAtletas.reverse();
            aplicarFiltros();
            renderizarHeatsRace();
            renderizarSelectorCF();
        } catch (error) { console.error(error); }
    }

    function switchMainTab(tab) {
        document.getElementById('viewGeneral').style.display = tab === 'general' ? 'block' : 'none';
        document.getElementById('viewLogistica').style.display = tab === 'logistica' ? 'block' : 'none';
        document.getElementById('tabGeneral').classList.toggle('active', tab === 'general');
        document.getElementById('tabLogistica').classList.toggle('active', tab === 'logistica');
    }

    function switchHeatType(type) {
        document.getElementById('containerHeatsRace').style.display = type === 'race' ? 'block' : 'none';
        document.getElementById('containerHeatsCF').style.display = type === 'cf' ? 'block' : 'none';
        document.getElementById('btnHeatRace').classList.toggle('active', type === 'race');
        document.getElementById('btnHeatCF').classList.toggle('active', type === 'cf');
    }

    function renderizarHeatsRace() {
        const cont = document.getElementById('containerHeatsRace');
        cont.innerHTML = "";
        let raceAtletas = todosLosAtletas
            .filter(a => a.modalidad.toLowerCase().includes('race') && a.estatus === 'Aprobado')
            .sort((a, b) => a.edad - b.edad);

        if (raceAtletas.length === 0) {
            cont.innerHTML = "<p style='text-align:center; padding:20px;'>No hay atletas.</p>";
            return;
        }

        for (let i = 0; i < raceAtletas.length; i += 10) {
            let grupo = raceAtletas.slice(i, i + 10);
            let heatNum = Math.floor(i / 10) + 1;
            let div = document.createElement('div');
            div.className = "container";
            div.innerHTML = `
                <div class="heat-header">
                    <span>HEAT ${heatNum}</span>
                    <span style="font-size:0.6rem;">Edades: ${grupo[0].edad}-${grupo[grupo.length-1].edad}</span>
                </div>
                <div class="table-wrapper">
                    <table>
                        <thead><tr><th>Foto</th><th>Atleta</th><th>#</th><th>Edad</th></tr></thead>
                        <tbody>
                            ${grupo.map(a => `
                                <tr>
                                    <td><img src="${formatImgUrl(a.fotoCarnet)}" style="width:30px; height:30px; border-radius:50%; object-fit:cover; border:1px solid var(--neon);"></td>
                                    <td><strong>${a.nombre}</strong></td>
                                    <td><span class="badge status-aprobado">#${a.dorsal}</span></td>
                                    <td>${a.edad}</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>`;
            cont.appendChild(div);
        }
    }

    function renderizarSelectorCF() {
        const sel = document.getElementById('selectorAtletasCF');
        sel.innerHTML = "";
        let ocupados = heatsCrossfitCreados.flatMap(h => h.atletas.map(at => at.fila));
        let cfAtletas = todosLosAtletas.filter(a => a.modalidad.toLowerCase().includes('crossfit') && a.estatus === 'Aprobado' && !ocupados.includes(a.fila));
        cfAtletas.forEach(a => {
            let chip = document.createElement('div');
            chip.className = "atleta-chip" + (seleccionadosCF.includes(a.fila) ? " selected" : "");
            chip.innerText = `${a.nombre}`;
            chip.onclick = () => {
                chip.classList.toggle('selected');
                if(seleccionadosCF.includes(a.fila)) seleccionadosCF = seleccionadosCF.filter(f => f !== a.fila);
                else seleccionadosCF.push(a.fila);
            };
            sel.appendChild(chip);
        });
    }

    function crearHeatManual() {
        if (seleccionadosCF.length === 0) return alert("Selecciona atletas.");
        let nuevosAtletas = todosLosAtletas.filter(a => seleccionadosCF.includes(a.fila));
        heatsCrossfitCreados.push({ id: Date.now(), atletas: nuevosAtletas });
        seleccionadosCF = [];
        actualizarVistaHeatsCF();
    }

    function borrarHeatCF(id) {
        if(!confirm("¿Borrar Heat?")) return;
        heatsCrossfitCreados = heatsCrossfitCreados.filter(h => h.id !== id);
        actualizarVistaHeatsCF();
    }

    function quitarAtletaDeHeatCF(heatId, fila) {
        let heat = heatsCrossfitCreados.find(h => h.id === heatId);
        heat.atletas = heat.atletas.filter(a => a.fila !== fila);
        if(heat.atletas.length === 0) heatsCrossfitCreados = heatsCrossfitCreados.filter(h => h.id !== heatId);
        actualizarVistaHeatsCF();
    }

    function actualizarVistaHeatsCF() {
        const cont = document.getElementById('listaHeatsManuales');
        cont.innerHTML = "";
        heatsCrossfitCreados.forEach((heat, idx) => {
            let div = document.createElement('div');
            div.className = "container";
            div.innerHTML = `
                <div class="heat-header" style="background:#fff;">
                    <span>HEAT ${idx + 1} (CF)</span>
                    <button class="btn-delete" onclick="borrarHeatCF(${heat.id})" style="background:none; border:none; color:red; cursor:pointer;"><i class="fas fa-trash"></i></button>
                </div>
                <div class="table-wrapper">
                    <table>
                        <thead><tr><th>Foto</th><th>Atleta</th><th>Cat.</th><th>X</th></tr></thead>
                        <tbody>
                            ${heat.atletas.map(a => `
                                <tr>
                                    <td><img src="${formatImgUrl(a.fotoCarnet)}" style="width:30px; height:30px; border-radius:50%; object-fit:cover; border:1px solid #333;"></td>
                                    <td><strong>${a.nombre}</strong></td>
                                    <td>${a.categoria}</td>
                                    <td><button class="btn-delete" onclick="quitarAtletaDeHeatCF(${heat.id}, ${a.fila})"><i class="fas fa-times"></i></button></td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>`;
            cont.prepend(div);
        });
        renderizarSelectorCF();
    }

    function filtrarModalidad(mod) {
        modalidadActual = mod.toLowerCase(); 
        document.querySelectorAll('#viewGeneral .btn-filter').forEach(b => b.classList.remove('active'));
        const btnId = mod === 'todos' ? 'btnAll' : mod === 'race' ? 'btnRace' : 'btnCF';
        document.getElementById(btnId).classList.add('active');
        resetearYPaginacion();
    }

    function aplicarFiltros() {
        const busqueda = document.getElementById('searchInput').value.toLowerCase();
        atletasFiltrados = todosLosAtletas.filter(atleta => {
            const cumpleMod = (modalidadActual === 'todos' || atleta.modalidad.toLowerCase().includes(modalidadActual));
            const dataStr = [atleta.nombre, atleta.apellido, atleta.cedula, atleta.referencia, atleta.dorsal].join(' ').toLowerCase();
            return cumpleMod && dataStr.includes(busqueda);
        });
        renderizarTabla();
    }

    function renderizarTabla() {
        const tabla = document.getElementById('tablaAtletas');
        const inicio = (paginaActual - 1) * registrosPorPagina;
        const atletasPagina = atletasFiltrados.slice(inicio, inicio + registrosPorPagina);
        tabla.innerHTML = "";
        atletasPagina.forEach((atleta, index) => {
            const tr = document.createElement('tr');
            tr.innerHTML = `
                <td data-label="Dorsal"><span class="badge ${atleta.estatus === 'Pendiente' ? 'status-pendiente' : 'status-aprobado'}">${atleta.dorsal || '??'}</span></td>
                <td data-label="Atleta"><strong>${atleta.nombre}</strong><br><small style="color:var(--neon)">${atleta.talla || 'S/N'}</small></td>
                <td data-label="Modalidad"><small>${atleta.modalidad.substring(0,2).toUpperCase()}</small></td>
                <td data-label="Pago"><small>${atleta.referencia.substring(0,4)}</small></td>
                <td data-label="Multimedia">
                    <a href="${atleta.fotoCarnet}" target="_blank" class="btn btn-view"><i class="fas fa-image"></i></a>
                </td>
                <td data-label="WhatsApp"><a href="https://wa.me/${String(atleta.whatsapp || atleta.telefono).replace(/\D/g,'')}" target="_blank" class="btn btn-wa"><i class="fab fa-whatsapp"></i></a></td>
                <td data-label="Acción">
                    <button class="btn btn-view" onclick='prepararEdicion(${inicio + index})'><i class="fas fa-edit"></i></button>
                    ${atleta.estatus === 'Pendiente' ? `<button class="btn btn-approve" onclick="procesarAprobacion(${atleta.fila},'${atleta.correo}','${atleta.nombre}')"><i class="fas fa-check"></i></button>` : ''}
                </td>`;
            tabla.appendChild(tr);
        });
        actualizarControlesPagina(atletasFiltrados.length);
    }

    function prepararEdicion(idx) {
        atletaAEditar = atletasFiltrados[idx];
        const contenedor = document.getElementById('camposEditar');
        contenedor.innerHTML = "";
        const campos = [
            {id: "nombre", label: "Nombre", valor: atletaAEditar.nombre}, {id: "apellido", label: "Apellido", valor: atletaAEditar.apellido},
            {id: "cedula", label: "Cédula", valor: atletaAEditar.cedula}, {id: "telefono", label: "Teléfono", valor: atletaAEditar.telefono},
            {id: "correo", label: "Correo", valor: atletaAEditar.correo}, {id: "talla", label: "Talla", valor: atletaAEditar.talla},
            {id: "modalidad", label: "Modalidad", valor: atletaAEditar.modalidad}, {id: "categoria", label: "Categoría", valor: atletaAEditar.categoria},
            {id: "dorsal", label: "Dorsal", valor: atletaAEditar.dorsal}, {id: "fecha", label: "Fecha Registro", valor: atletaAEditar.fecha}
        ];
        campos.forEach(c => {
            contenedor.innerHTML += `<div><label>${c.label}</label><input type="text" id="edit_${c.id}" value="${c.valor || ''}"></div>`;
        });
        document.getElementById('modalEditar').style.display = 'block';
        document.getElementById('btnGuardarEdit').onclick = guardarEdicion;
    }

    async function guardarEdicion() {
        const payload = {
            accion: "editar", fila: atletaAEditar.fila,
            nombre: document.getElementById('edit_nombre').value, apellido: document.getElementById('edit_apellido').value,
            cedula: document.getElementById('edit_cedula').value, telefono: document.getElementById('edit_telefono').value,
            correo: document.getElementById('edit_correo').value, talla: document.getElementById('edit_talla').value,
            modalidad: document.getElementById('edit_modalidad').value, categoria: document.getElementById('edit_categoria').value,
            dorsal: document.getElementById('edit_dorsal').value, fecha: document.getElementById('edit_fecha').value
        };
        if(!confirm("¿Guardar cambios?")) return;
        await fetch(WEB_APP_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(payload) });
        document.getElementById('modalEditar').style.display = 'none';
        cargarAtletas();
    }

    async function eliminarAtleta(fila, n) {
        if(!confirm(`¿Eliminar a ${n}?`)) return;
        await fetch(WEB_APP_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ accion: "eliminar", fila: fila }) });
        cargarAtletas();
    }

    function actualizarControlesPagina(t) {
        const totalPaginas = Math.ceil(t / registrosPorPagina);
        document.getElementById('pageInfo').innerText = `Pág ${paginaActual} / ${totalPaginas || 1}`;
        document.getElementById('prevPage').disabled = paginaActual === 1;
        document.getElementById('nextPage').disabled = paginaActual >= totalPaginas;
    }

    function cambiarPagina(d) { paginaActual += d; renderizarTabla(); window.scrollTo(0,0); }
    function resetearYPaginacion() { paginaActual = 1; aplicarFiltros(); }

    async function procesarAprobacion(f, c, n) {
        if(!confirm(`¿Aprobar a ${n}?`)) return;
        await fetch(WEB_APP_URL, { method: 'POST', mode: 'no-cors', body: JSON.stringify({ accion: "aprobar", fila: f, correo: c, nombre: n }) });
        cargarAtletas();
    }
</script>
</body>
</html>
